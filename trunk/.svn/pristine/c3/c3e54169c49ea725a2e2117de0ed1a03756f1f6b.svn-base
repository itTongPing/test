<!DOCTYPE html>
<html lang="en" xmlns="://.w3.org/1999/xhtml" xmlns:th="://.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>进销存报表</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
   	<head th:include="decorators/tags/main" />
    <head th:include="decorators/tags/menuBaiyi" />
    <style>
        .fixed-table-toolbar .columns {
            top: 76px!important;
        }
    </style>
</head>
<body class="overflow-hidden" >
<div class="wrapper preload no-left">
    <ul class="breadcrumb">
        <li><span class="primary-font"><i class="icon-home"></i></span>统计报表</li>
         <li><span class="primary-font"><i class="icon-home"></i></span>进销存报表</li>
        <li>进销存列表</li>
    </ul>
    <div class="main-container ">
        <div class="padding-md">
        <!-- 搜索栏 -->
        <form class="form-inline no-margin" id="queryForm" action = '/report/purchaseSellStock/export' method = 'get'>
	        <div class="fun-btn">
	        	<button  type="submit" class="btn btn-blue">导出</button>
	        </div>
            <div class="smart-widget-inner product_info">
                <div class="search-form-div">
                        <div class="search_l">
                        
                           <div class="form-group ">
                                                                                                                                 日期
                                    <div class="btn-group btn_group">
                                        <input size="16" type="text" id="orderDateStart" name="dateStart" value="" placeholder="开始时间" class="form-control form_datetime " data-date-format="yyyy-mm-dd" onclick="showDate(this)"></input>
                                        <input size="16" type="text" id="orderDateEnd" name="dateEnd" value="" placeholder="结束时间" class="form-control form_datetime " data-date-format="yyyy-mm-dd" onclick="showDate(this)"></input>
                                    </div>
                                </div>
                        
                        
                        	<!-- sku -->
                            <div class="form-group">SKU
                                <input type="text" id="sku" name="sku" class="form-control" placeholder="输入SKU"/>
                            </div>
                            <!-- 仓库 -->
                        	<div class="form-group" style="margin:5px 0">仓库
                                <select class="selectpicker show-tick form-control" multiple="multiple"
                                        id="warehouses" data-live-search="true" name = 'warehouses'>
                                    <option value='-1' selected='true'>全部</option>
                                    <option th:each="warehouses :${warehouses}"
                                            th:value="${warehouses.stock_id}"
                                            th:text="${warehouses.warehouse_name}"></option>
                                </select>
                            </div>
                              <!-- 事业部-->
                        	<div class="form-group" style="margin:5px 0">事业部
                                <select class="selectpicker show-tick form-control" multiple="multiple"
                                        id="depart" data-live-search="true" name = 'deptId'>
                                    <option value='-1' selected='true'>全部</option>
                                    <option th:each="dept :${deptList}"
                                            th:value="${dept.id}"
                                            th:text="${dept.name}"></option>
                                </select>
                            </div>
                        </div>
                        <div class="search_r">
                            <button type="button" class="btn btn-success marginTB-xs" onclick="searchResult()">搜索</button>
                            <img class="resetbutton" src="/images/icon_Advanced-search.png" onclick="searchReset()" />
                        </div>
                </div>
                <!-- 表格 -->
                <table id="table01" class = 'table-scroll'
                data-toggle="table"
                data-url = '/report/purchaseSellStock/search'
                data-query-params="query_params"
                data-id-field="sku"
                data-unique-id="sku"
                data-pagination="true"
                data-side-pagination="server"
                data-page-size="20"
                data-page-list="[20, 50, 100, 200]"
                >
                <thead>
	                    <th data-field = 'legalerName'>法人主体</th>
	                	<th data-field = 'companyName'>事业部</th>
	                    <th data-field = 'sku'>SKU</th>
	                    <th data-field = 'skuName' data-formatter="formatSku">SKU名称</th>
	                	<th data-field = 'categoryName'>品类</th>
	                    <th data-field = 'warehouseName'>仓库名称</th>
	                    <!-- <th data-colspan="3">入库</th>
	                    <th data-colspan="3">出库</th>
	                    <th data-colspan="3">库存</th>
	                    <th data-colspan="3">占用</th>	 -->       
                    	<th data-field = 'inCount'>入库数量</th>
	                	<th data-field = 'inPrice'>入库金额</th>
	                    <th data-field = 'inSize'>入库体积</th>
                     	<th data-field = 'outCount'>出库数量</th>
	                	<th data-field = 'outPrice'>出库金额</th>
	                    <th data-field = 'outSize'>出库体积</th>
	                    <th data-field = 'stockCount'>库存数量</th>
	                	<th data-field = 'stockPrice'>库存金额</th>
	                    <th data-field = 'stockSize'>库存体积</th>
	                    <th data-field = 'occupyCount'>占用数量</th>
	                	<th data-field = 'occupyPrice'>占用金额</th>
	                    <th data-field = 'occupySize'>占用体积</th>
	                     <th data-field = 'onwayCount'>在途数量</th>
	                	<th data-field = 'onwayPrice'>在途金额</th>
	                    <th data-field = 'onwaySize'>在途体积</th>
                </thead>
                </table>
            </div><!-- ./smart-widget-inner -->
		</form>
        </div><!-- ./padding-md -->
    </div><!-- /main-container -->
    <!-- 引入页脚 -->
    <head th:include="decorators/tags/footer_mini"/>
</div>
    <script th:inline="javascript">
        /*<![CDATA[*/

        var steps = [[${steps}]];
        if (steps != null) {
            var stepsList = steps.split(",");
            $('#processStatus').val(stepsList);
        }

        //获取后台传过来的服务器时间
        var nowtime = [[${nowTime}]];
        //日历插件配置方法
        function date(className) {
            $("." + className).datetimepicker({
                format: 'yyyy-mm-dd',
                autoclose: true,
                language: 'zh-CN',
                minView: '2',
                toggleActive: false,
                zIndexOffset: 1,
                endDate: nowtime //结束时间为今天    即之后的时间都不能选择        '+0d' 表示今天    '-1d'表示昨天   '+1d表示明天'
                    //展示到天数就行
            });
        }
        
        date('form_datetime');
        
        //获取当前时间信息
        function getNowFormatDate() {
            var date = new Date();
            var seperator = "-";
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            var strDate = date.getDate();
            if (month <= 9) {
                month = "0" + month;
            }
            if (strDate <= 9) {
                strDate = "0" + strDate;
            }
            var currentdate = year + seperator + month + seperator + strDate;
            return currentdate;
        }
        //获取月初的值
        function getNowMonthFirstDayFormatDate(){
        	var date = new Date();
        	var seperater = "-";
        	var year = date.getFullYear();
        	var month=date.getMonth()+1;
        	 if (month <= 9) {
                 month = "0" + month;
             }
        	var monthStart = year + seperater+month + seperater +"01";
        	return monthStart;
        }
        
        $("#orderDateEnd").val(getNowFormatDate());
        $("#orderDateStart").val(getNowMonthFirstDayFormatDate());
        function showDate(obj) {
            var id = $(obj).attr('id');
            $('#' + id).datetimepicker('show');
        }
        
        function formatSku(value, row, index){
            var sHtml = "";
            if (value != null && value.length > 30) {
                sHtml += '<div>' + '<span title="' + value + '">' + value.substring(0, 30) + '...</span>' + '</div>';
	         }
            else{
                sHtml += '<div>' + '<span title="' + value + '">' + value + '</span>' + '</div>';
          	}
            return sHtml;
        }
        /*]]>*/
    </script>

<!-- 当前页面脚本 -->
<script th:src="@{'/js/purchaseSellStockReport.js?v='+${version}}"></script>
</body>
</html>
